<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Interactive Celestial Sphere</title>
<style>
    body{
        background:#000;
        color:white;
        font-family:sans-serif;
        text-align:center;
    }
    canvas{
        background:black;
        border:1px solid white;
    }
    .controls{
        margin-top:10px;
    }
</style>
</head>
<body>

<h2>Interactive Celestial Sphere</h2>
<canvas id="sky" width="600" height="600"></canvas>

<div class="controls">
Latitude:
<input type="range" id="lat" min="-90" max="90" value="25" step="1">
<span id="latVal">25</span>°

<br>

Time:
<input type="range" id="time" min="0" max="24" value="0" step="0.1">
<span id="timeVal">0</span> h
<br>
Arrow control ↑↓←→ to rotate
</div>

<script>
const canvas = document.getElementById("sky");
const ctx = canvas.getContext("2d");
const center = 300;
const radius = 250;

//星星資料 RA(deg), Dec(deg)
const stars = [
["天狼星",101.2871554,-16.71611583,"lightblue"],
["參宿四",88.79293875,7.407062778,"orange"],
["參宿七",78.63458333,-8.20166667,"blue"],
["織女一",279.2345833,38.78361111,"white"],
["北極星",37.95291667,89.26416667,"yellow"],
["河鼓二",297.6958292,8.868321944,"white"],
["畢宿五",68.98016279,16.50930236,"red"],
["心宿二",247.35,-26.43194444,"red"],
["角宿一",201.3982471,-11.16132194,"lightblue"],
["天津四",310.3579167,45.28027778,"white"]
];

function deg2rad(d){return d*Math.PI/180;}

let viewOffset = 0; 

function radecToAltAz(ra,dec,lat,time){
    ra=deg2rad(ra); dec=deg2rad(dec); lat=deg2rad(lat);
    let H = deg2rad(time*15) - ra;

    let sinAlt = Math.sin(lat)*Math.sin(dec) +
                 Math.cos(lat)*Math.cos(dec)*Math.cos(H);
    let alt = Math.asin(sinAlt);

    let cosAz = (Math.sin(dec)-Math.sin(alt)*Math.sin(lat)) /
                (Math.cos(alt)*Math.cos(lat));
    let az = Math.acos(cosAz);

    if(Math.sin(H)>0) az = 2*Math.PI - az;
    return [alt*180/Math.PI, az*180/Math.PI];
}

function drawSky(lat,time){
    ctx.clearRect(0,0,600,600);

    //地平線
    ctx.beginPath();
    ctx.arc(center,center,radius,0,Math.PI*2);
    ctx.strokeStyle="white";
    ctx.stroke();

    stars.forEach(star=>{
        let altaz = radecToAltAz(star[1],star[2],lat,time);
        let alt = altaz[0];
        let az = altaz[1];

        if(alt>0){
            let r = radius*(90-alt)/90;
            let x = center + r*Math.sin(deg2rad(az));
            let y = center - r*Math.cos(deg2rad(az));

            ctx.beginPath();
            ctx.arc(x,y,4,0,Math.PI*2);
            ctx.fillStyle=star[3];
            ctx.fill();

            ctx.fillText(star[0],x+5,y);
        }
    });
}

//滑桿控制
const latSlider=document.getElementById("lat");
const timeSlider=document.getElementById("time");

function update(){
    document.getElementById("latVal").innerText=latSlider.value;
    document.getElementById("timeVal").innerText=timeSlider.value;
    drawSky(parseFloat(latSlider.value),parseFloat(timeSlider.value));
}

latSlider.oninput=update;
timeSlider.oninput=update;

update();

window.addEventListener("keydown",(e)=>{
    if(e.key=="ArrowLeft")viewOffset-=0.1;
    if(e.key=="ArrowRidht")viewOffset-=0.1;
    update();
});

</script>

</body>
</html>
